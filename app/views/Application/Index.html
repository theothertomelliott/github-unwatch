{{set . "title" "Home"}}
{{template "header.html" .}}


{{if .me}}
<h3>You're {{.me.Name}} on GitHub</h3>

<h1>Watched Repos</h1>

<div id="app">
	<ul class="list-group">
		<li  class="list-group-item" v-for="org in orgs">
			<span class="badge">{{"{{"}} org.repoCount {{"}}"}}</span>
			<span data-toggle="collapse" data-target="#list{{"{{"}}org.login{{"}}"}}" class="accordion-toggle">
				{{"{{"}} org.login {{"}}"}} - {{"{{"}} org.repoCount {{"}}"}}
			</span>
			<a href="/Application/Unsubscribe?login={{"{{"}}org.login{{"}}"}}">[Unsubscribe all]</a>
			<ul class="list-group accordian-body collapse" id="list{{"{{"}}org.login{{"}}"}}">
				<li class="list-group-item" v-for="repo in org.repos">
					{{"{{"}} repo.name {{"}}"}}
				</li>
		</li>
	</ul>
</div>

{{end}}

<script>
new Vue({
	el: '#app',
	data: {
		orgs: [
{{if .watchedByLogin}}
	{{ range $login, $repos := .watchedByLogin }}
		{
		  login: '{{$login}}',
		  repoCount: {{ len $repos }},
		  repos: [
		  	{{ range $repos }}
		  	{ name: "{{.FullName}}" },
		  	{{ end }}
		  ]
		},
	{{end}}
{{end}}
		]
	}
});

</script>

{{template "footer.html" .}}
