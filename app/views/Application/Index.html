{{set . "title" "Home"}}
{{template "header.html" .}}


{{if .me}}
<h3>You're {{.me.Name}} on GitHub</h3>

<h1>Watched Repos</h1>


<div id="app">

	<div class="row">
	<div class="col-lg-12">
		<div class="input-group">
			<input type="text" class="form-control" placeholder="Search for..." v-model="searchQuery">
			<!-- For some reason this stretches it to the end -->
			<span class="input-group-btn">
				<button class="btn btn-default" type="button">Go!</button>
			</span>
		</div><!-- /input-group -->
	</div><!-- /.col-lg-12 -->
</div><!-- /.row -->

<br/><br/>

<div id="example">
	<a href v-on:click="unsubscribe">Unsubscribe from ${filteredRepos.length} repositories</a>
</div>

	<div class="row">
	<ul class="list-group">
		<li  class="list-group-item" v-for="repo in filteredRepos">
			${ repo.name }
		</li>

	</ul>
	</div>

	<br/><br/>

	<div class="row">
	<ul class="list-group">
		<li  class="list-group-item" v-for="org in orgsByLogin | filterBy searchQuery in 'login'">
			<span class="badge">${ org.repoCount}</span>
			<span data-toggle="collapse" data-target="#list${org.login}" class="accordion-toggle">
				${ org.login } - ${ org.repoCount }
			</span>
			<a href="/Application/Unsubscribe?login=${org.login}">[Unsubscribe all]</a>
			<ul class="list-group accordian-body collapse" id="list${org.login}">
				<li class="list-group-item" v-for="repo in org.repos">
					 ${ repo.name }
				</li>
		</li>
	</ul>
	</div>
</div>


{{end}}

<script>

Vue.config.delimiters = ["${", "}"]

new Vue({
	el: '#app',
	data: {
		searchQuery: '',
		orgsByLogin: [
{{if .watchedByLogin}}
	{{ range $login, $repos := .watchedByLogin }}
		{
		  login: '{{$login}}',
		  repoCount: {{ len $repos }},
		  repos: [
		  	{{ range $repos }}
		  	{ name: "{{.FullName}}" },
		  	{{ end }}
		  ]
		},
	{{end}}
{{end}}
		],
		repos: [
{{if .watchedByLogin}}
	{{ range $login, $repos := .watchedByLogin }}
		  	{{ range $repos }}
		  	{ name: "{{.FullName}}" },
		  	{{ end }}
	{{end}}
{{end}}
		]
	},

	methods: {
		unsubscribe: function(event){
			alert("Will unsubscribe");
		}
	},

	computed: {
		filteredRepos: function () {
			return this.repos.filter(function(repo){
				return repo.name.indexOf(this.searchQuery) > -1;
			}.bind(this));
		}
	}
});

</script>

{{template "footer.html" .}}
